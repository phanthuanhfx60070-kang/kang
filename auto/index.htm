<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RSI æç«¯åšç©º - ç§»åŠ¨ä¸“ä¸šç‰ˆ</title>
    
    <!-- PWA ç§»åŠ¨ç«¯ App é…ç½® -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SentinelBot">
    <meta name="theme-color" content="#0b0e11">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { 
            background-color: #0b0e11; 
            color: #eaecef; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: contain; /* ç¦ç”¨ä¸‹æ‹‰åˆ·æ–° */
        }
        .safe-area-top { padding-top: env(safe-area-inset-top); }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .app-card { background-color: #1e2329; border-radius: 24px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .nav-item.active { color: #f0b90b; }
        .rsi-circle { width: 110px; height: 110px; border-radius: 50%; border: 4px solid #2b3139; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #1e2329 0%, #161a1e 100%); }
        .input-mobile { background-color: #161a1e; border: 1px solid #2b3139; border-radius: 12px; padding: 12px; width: 100%; color: white; font-size: 16px; transition: border-color 0.2s; }
        .input-mobile:focus { border-color: #f0b90b; outline: none; }
        
        .status-bar { background: rgba(11, 14, 17, 0.85); backdrop-filter: blur(15px); }
        @keyframes pulse-red { 0%, 100% { color: #f6465d; } 50% { color: #ff8d9b; } }
        .animate-alert { animation: pulse-red 0.8s infinite; }
        
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-[#0b0e11] select-none">

    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <div class="status-bar sticky top-0 z-50 px-6 pb-3 pt-[calc(env(safe-area-inset-top)+12px)] border-b border-[#2b3139] flex justify-between items-center">
        <div class="flex items-center">
            <div id="dot" class="w-2.5 h-2.5 rounded-full bg-slate-500 mr-2"></div>
            <span id="statusTxt" class="text-[10px] font-black uppercase tracking-widest text-slate-400">Offline</span>
        </div>
        <div class="text-[#f0b90b] font-black text-xs tracking-tighter italic">SENTINEL SYSTEM</div>
    </div>

    <main class="px-4 pt-4 pb-32">
        
        <!-- Tab 1: ç›‘æ§çœ‹æ¿ -->
        <section id="tab-dashboard" class="tab-content active space-y-4">
            <div class="app-card p-6 shadow-2xl relative overflow-hidden border border-white/5">
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <h2 id="displaySymbol" class="text-4xl font-black tracking-tighter italic">VTHOUSDT</h2>
                        <div class="flex items-center gap-1.5 mt-1">
                            <span class="px-1.5 py-0.5 bg-red-500/20 text-red-500 text-[9px] font-black rounded uppercase">Short Strategy</span>
                            <p class="text-[9px] text-slate-500 font-bold uppercase tracking-widest">Perpetual</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p id="displayPrice" class="text-3xl font-mono text-[#f0b90b] font-black tracking-tighter">---</p>
                        <p class="text-[9px] text-slate-600 font-bold uppercase mt-1 tracking-widest">Mark Price</p>
                    </div>
                </div>
                
                <div class="flex justify-around mt-10 mb-2">
                    <div class="text-center group">
                        <div class="rsi-circle mb-3 mx-auto shadow-inner border-[#2b3139] group-active:scale-95 transition-transform">
                            <span id="rsi15v" class="text-3xl font-black text-slate-200">--</span>
                        </div>
                        <span class="text-[10px] text-slate-500 font-black uppercase tracking-widest">15m RSI</span>
                    </div>
                    <div class="text-center group">
                        <div class="rsi-circle mb-3 mx-auto shadow-inner border-[#2b3139] group-active:scale-95 transition-transform">
                            <span id="rsi1hv" class="text-3xl font-black text-slate-200">--</span>
                        </div>
                        <span class="text-[10px] text-slate-500 font-black uppercase tracking-widest">1h RSI</span>
                    </div>
                </div>
            </div>

            <div id="positionCard" class="app-card p-6 border-l-4 border-slate-700 shadow-lg">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-[10px] text-slate-500 font-black uppercase tracking-widest">Trading State</p>
                        <p id="posStatusText" class="text-xl font-black mt-1 text-slate-400 uppercase">Scanning</p>
                    </div>
                    <div class="text-right">
                        <p id="displayROI" class="text-3xl font-black tabular-nums">-- %</p>
                        <p class="text-[10px] text-slate-500 font-black uppercase tracking-widest">ROI Ratio</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-y-5 gap-x-4 mt-8 pt-6 border-t border-white/5">
                    <div>
                        <p class="text-[9px] text-slate-500 font-bold uppercase">å…¥åœºå‡ä»·</p>
                        <p id="statEntry" class="font-bold text-slate-200 text-sm">--</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[9px] text-slate-500 font-bold uppercase">ç´¯è®¡è¡¥ä»“</p>
                        <p id="statAdd" class="font-bold text-slate-200 text-sm">0 æ¬¡</p>
                    </div>
                    <div>
                        <p class="text-[9px] text-slate-500 font-bold uppercase">è´¦æˆ·ä½™é¢ (USDT)</p>
                        <p id="statBalance" class="font-bold text-slate-200 text-sm">--</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[9px] text-slate-500 font-bold uppercase">æœªå®ç°ç›ˆäº(U)</p>
                        <p id="statPnl" class="font-bold text-slate-200 text-sm">--</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab 2: ç­–ç•¥è®¾ç½® -->
        <section id="tab-strategy" class="tab-content space-y-6">
            <div class="app-card p-6 shadow-xl">
                <h3 class="text-sm font-black mb-6 flex items-center text-[#f0b90b] uppercase tracking-widest">
                    <span class="w-1 h-4 bg-[#f0b90b] mr-2 rounded-full"></span>
                    Strategy Parameters
                </h3>
                <div class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-[10px] text-slate-500 block mb-2 font-black uppercase">ç›‘æµ‹å¸ç§</label>
                            <input type="text" id="symbol" class="input-mobile uppercase font-black" value="VTHOUSDT">
                        </div>
                        <div>
                            <label class="text-[10px] text-slate-500 block mb-2 font-black uppercase">æ æ†å€æ•°</label>
                            <input type="number" id="leverage" class="input-mobile font-bold" value="10">
                        </div>
                    </div>
                    <div>
                        <label class="text-[10px] text-slate-500 block mb-2 font-black uppercase">RSI åšç©ºè§¦å‘çº¿ (åŒå‘¨æœŸ)</label>
                        <input type="number" id="buyThreshold" class="input-mobile text-blue-400 font-black text-xl" value="97">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-[10px] text-slate-500 block mb-2 font-black uppercase">æ­¢ç›ˆ ROI (%)</label>
                            <input type="number" id="targetROI" class="input-mobile text-emerald-400 font-black" value="30">
                        </div>
                        <div>
                            <label class="text-[10px] text-slate-500 block mb-2 font-black uppercase">åŠ ä»“ ROI (%)</label>
                            <input type="number" id="addThresholdROI" class="input-mobile text-red-400 font-black" value="-20">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-[10px] text-slate-500 block mb-2 font-black uppercase">é¦–æ¬¡å¼€ä»“ (U)</label>
                            <input type="number" id="initU" class="input-mobile" value="1">
                        </div>
                        <div>
                            <label class="text-[10px] text-slate-500 block mb-2 font-black uppercase">åŠ ä»“é‡‘é¢ (U)</label>
                            <input type="number" id="addU" class="input-mobile" value="2">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab 3: API & ç³»ç»Ÿ -->
        <section id="tab-settings" class="tab-content space-y-6">
            <div class="app-card p-6 shadow-xl">
                <h3 class="text-sm font-black mb-6 flex items-center text-blue-400 uppercase tracking-widest">
                    <span class="w-1 h-4 bg-blue-400 mr-2 rounded-full"></span>
                    Account Secure Access
                </h3>
                <div class="space-y-4">
                    <div class="space-y-1">
                        <label class="text-[9px] text-slate-500 uppercase font-bold px-1">API Key</label>
                        <input type="password" id="apiKey" class="input-mobile text-sm" placeholder="Paste Key">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[9px] text-slate-500 uppercase font-bold px-1">Secret Key</label>
                        <input type="password" id="apiSecret" class="input-mobile text-sm" placeholder="Paste Secret">
                    </div>
                    <div class="p-4 bg-blue-500/5 rounded-xl border border-blue-500/10 text-[10px] text-slate-500 leading-relaxed italic">
                        * å¯†é’¥ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ç¼“å­˜ä¸­ã€‚è¯·ç¡®ä¿å·²å¼€å¯æµè§ˆå™¨è·¨åŸŸ(CORS)æ’ä»¶ã€‚
                    </div>
                    <button onclick="localStorage.clear(); location.reload();" class="w-full py-4 text-[10px] text-red-500/60 font-black uppercase tracking-widest border border-red-500/10 rounded-xl mt-4">Reset Application Data</button>
                </div>
            </div>
        </section>

        <!-- Tab 4: è¿è¡Œæ—¥å¿— -->
        <section id="tab-logs" class="tab-content">
            <div class="app-card p-4 h-[65vh] flex flex-col shadow-inner">
                <div class="flex justify-between items-center mb-4 px-2">
                    <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Live Engine Logs</h3>
                    <button onclick="document.getElementById('logs').innerHTML=''" class="text-[9px] text-slate-600 font-bold uppercase">Clear</button>
                </div>
                <div id="logs" class="log-panel flex-1 overflow-y-auto p-3 rounded-2xl bg-black/20 text-[11px] font-mono leading-relaxed">
                    <div class="text-slate-700 italic">> ç­‰å¾…æŒ‡ä»¤å¼€å¯ç›‘æ§...</div>
                </div>
            </div>
        </section>

    </main>

    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <nav class="fixed bottom-0 left-0 right-0 bg-[#1e2329]/95 backdrop-blur-xl border-t border-white/5 px-6 pt-3 pb-[calc(env(safe-area-inset-bottom)+12px)] flex justify-between items-center z-50 shadow-2xl">
        <button onclick="showTab('dashboard')" class="nav-item active flex flex-col items-center gap-1 transition-all active:scale-90">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
            <span class="text-[9px] font-black uppercase">Dashboard</span>
        </button>
        <button onclick="showTab('strategy')" class="nav-item flex flex-col items-center gap-1 text-slate-500 transition-all active:scale-90">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
            <span class="text-[9px] font-black uppercase">Strategy</span>
        </button>
        
        <!-- å¯åŠ¨æŒ‰é’® -->
        <div class="relative -mt-12">
            <button id="runBtn" class="bg-[#f0b90b] text-[#0b0e11] w-16 h-16 rounded-full flex items-center justify-center shadow-[0_8px_20px_rgba(240,185,11,0.3)] border-[6px] border-[#0b0e11] active:scale-90 transition-transform">
                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>
            </button>
            <button id="stopBtn" class="hidden bg-red-500 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-[0_8px_20px_rgba(239,68,68,0.3)] border-[6px] border-[#0b0e11] active:scale-90 transition-transform">
                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"></path></svg>
            </button>
        </div>

        <button onclick="showTab('settings')" class="nav-item flex flex-col items-center gap-1 text-slate-500 transition-all active:scale-90">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            <span class="text-[9px] font-black uppercase">Account</span>
        </button>
        <button onclick="showTab('logs')" class="nav-item flex flex-col items-center gap-1 text-slate-500 transition-all active:scale-90">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
            <span class="text-[9px] font-black uppercase">Logs</span>
        </button>
    </nav>

    <audio id="alert" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>

    <script>
        let isRunning = false;
        let timer = null;
        let isHolding = false;
        let addLock = false; 
        const fapi = "https://fapi.binance.com";

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.add('text-slate-500');
                btn.classList.remove('text-[#f0b90b]');
            });
            document.getElementById(`tab-${tabId}`).classList.add('active');
            event.currentTarget.classList.add('text-[#f0b90b]');
            event.currentTarget.classList.remove('text-slate-500');
            if(window.navigator.vibrate) window.navigator.vibrate(10);
        }

        window.onload = () => {
            const k = localStorage.getItem('_local_k');
            const s = localStorage.getItem('_local_s');
            if(k) document.getElementById('apiKey').value = k;
            if(s) document.getElementById('apiSecret').value = s;
        };

        function hmac256(msg, secret) {
            return CryptoJS.HmacSHA256(msg, secret).toString(CryptoJS.enc.Hex);
        }

        async function signedRequest(method, endpoint, params = {}) {
            const key = document.getElementById('apiKey').value;
            const secret = document.getElementById('apiSecret').value;
            if(!key || !secret) return { msg: "Keys Required" };
            const timestamp = Date.now();
            let query = Object.keys(params).map(k => `${k}=${params[k]}`).join('&');
            query += (query ? '&' : '') + `timestamp=${timestamp}&recvWindow=10000`;
            const signature = hmac256(query, secret);
            const res = await fetch(`${fapi}${endpoint}?${query}&signature=${signature}`, {
                method, headers: { 'X-MBX-APIKEY': key }
            });
            return await res.json();
        }

        function calculateRSI(closes, period = 14) {
            let changes = [];
            for (let i = 1; i < closes.length; i++) changes.push(closes[i] - closes[i - 1]);
            let g = 0, l = 0;
            for (let i = 0; i < period; i++) { if (changes[i] > 0) g += changes[i]; else l -= changes[i]; }
            let ag = g/period, al = l/period;
            for (let i = period; i < changes.length; i++) {
                let cg = changes[i] > 0 ? changes[i] : 0, cl = changes[i] < 0 ? -changes[i] : 0;
                ag = (ag * (period - 1) + cg) / period; al = (al * (period - 1) + cl) / period;
            }
            return 100 - (100 / (1 + (ag / (al || 1e-9))));
        }

        async function executeTrade(symbol, side, qty) {
            try {
                const lev = document.getElementById('leverage').value;
                await signedRequest('POST', '/fapi/v1/leverage', { symbol, leverage: lev });
                const order = await signedRequest('POST', '/fapi/v1/order', { symbol, side, type: 'MARKET', quantity: qty });
                if(order.orderId) {
                    addLog(`ğŸ”¥ [Trade] ${side} æ‰§è¡ŒæˆåŠŸ`, 'text-emerald-400 font-black');
                    return true;
                }
                addLog(`âš ï¸ [Trade Error] ${order.msg}`, 'text-red-400 font-bold'); return false;
            } catch (e) { addLog(`âŒ [Network] äº¤æ˜“å¼‚å¸¸ï¼Œæ£€æŸ¥è·¨åŸŸæ’ä»¶`, 'text-red-400'); return false; }
        }

        function addLog(msg, color = 'text-slate-500') {
            const box = document.getElementById('logs');
            const div = document.createElement('div');
            div.className = `${color} border-b border-white/5 py-2`;
            div.innerHTML = `<span class="opacity-30 mr-2 text-[9px]">${new Date().toLocaleTimeString()}</span> ${msg}`;
            box.prepend(div);
        }

        async function engine() {
            const sym = document.getElementById('symbol').value.toUpperCase();
            const threshold = parseFloat(document.getElementById('buyThreshold').value);
            const lev = parseFloat(document.getElementById('leverage').value);
            const tp = parseFloat(document.getElementById('targetROI').value);
            const addLimit = parseFloat(document.getElementById('addThresholdROI').value);
            const initU = parseFloat(document.getElementById('initU').value);
            const addU = parseFloat(document.getElementById('addU').value);

            try {
                const [r15, r1h] = await Promise.all([
                    fetch(`${fapi}/fapi/v1/klines?symbol=${sym}&interval=15m&limit=500`).then(r => r.json()),
                    fetch(`${fapi}/fapi/v1/klines?symbol=${sym}&interval=1h&limit=500`).then(r => r.json())
                ]);
                const c15 = r15.map(d => parseFloat(d[4])), c1h = r1h.map(d => parseFloat(d[4]));
                const price = c15[c15.length-1], r15v = calculateRSI(c15), r1hv = calculateRSI(c1h);

                const [positions, balanceData] = await Promise.all([
                    signedRequest('GET', '/fapi/v2/positionRisk', { symbol: sym }),
                    signedRequest('GET', '/fapi/v2/balance')
                ]);
                const pos = Array.isArray(positions) ? positions.find(p => p.symbol === sym) : null;
                if(!pos) return;
                
                const amt = parseFloat(pos.positionAmt), entry = parseFloat(pos.entryPrice);
                isHolding = amt < 0; 
                const usdt = balanceData.find(b => b.asset === 'USDT');
                const roi = isHolding ? (entry - price) / entry * lev * 100 : 0;

                document.getElementById('displaySymbol').innerText = sym;
                document.getElementById('displayPrice').innerText = price > 1 ? price.toFixed(4) : price.toFixed(6);
                
                const r15El = document.getElementById('rsi15v');
                const r1hEl = document.getElementById('rsi1hv');
                r15El.innerText = r15v.toFixed(1);
                r1hEl.innerText = r1hv.toFixed(1);
                
                if(r15v >= threshold - 3) r15El.className = 'text-3xl font-black text-red-500 animate-alert'; else r15El.className = 'text-3xl font-black text-slate-200';
                if(r1hv >= threshold - 3) r1hEl.className = 'text-3xl font-black text-red-500 animate-alert'; else r1hEl.className = 'text-3xl font-black text-slate-200';

                document.getElementById('statBalance').innerText = usdt ? parseFloat(usdt.balance).toFixed(2) : '--';
                
                if(isHolding) {
                    document.getElementById('positionCard').className = 'app-card p-6 border-l-4 border-blue-500 shadow-xl';
                    document.getElementById('posStatusText').innerText = "SHORTING";
                    document.getElementById('posStatusText').className = "text-xl font-black mt-1 text-blue-400";
                    document.getElementById('displayROI').innerText = `${roi >= 0 ? '+' : ''}${roi.toFixed(2)} %`;
                    document.getElementById('displayROI').className = `text-3xl font-black ${roi >= 0 ? 'text-emerald-400' : 'text-red-400'}`;
                    document.getElementById('statEntry').innerText = entry.toFixed(6);
                    document.getElementById('statPnl').innerText = parseFloat(pos.unrealizedProfit).toFixed(2);
                } else {
                    document.getElementById('positionCard').className = 'app-card p-6 border-l-4 border-slate-700';
                    document.getElementById('posStatusText').innerText = "SCANNING";
                    document.getElementById('posStatusText').className = "text-xl font-black mt-1 text-slate-500";
                    document.getElementById('displayROI').innerText = "-- %";
                    document.getElementById('displayROI').className = "text-3xl font-black text-slate-700";
                    document.getElementById('statEntry').innerText = "--";
                    document.getElementById('statPnl').innerText = "--";
                }

                if(r15v >= threshold && r1hv >= threshold && !isHolding) {
                    addLog(`[ALERT] ä¿¡å·è§¦å‘! å¼€å§‹åšç©º`, 'text-orange-400 font-black');
                    document.getElementById('alert').play();
                    let qty = Math.floor((initU * lev) / price);
                    if(await executeTrade(sym, 'SELL', qty)) { isHolding = true; addLock = false; }
                }

                if(isHolding && roi >= tp) {
                    addLog(`[TARGET] æ”¶ç›Šè¾¾æ ‡ï¼Œæ­¢ç›ˆå¹³ä»“`, 'text-emerald-400 font-black');
                    if(await executeTrade(sym, 'BUY', Math.abs(amt))) isHolding = false;
                }

                if(isHolding && roi <= addLimit && !addLock) {
                    addLog(`[ADD] è§¦å‘è¡¥ä»“çº¿ï¼Œè¿½åŠ  2U ä»“ä½`, 'text-red-400 font-black');
                    let addQty = Math.floor((addU * lev) / price);
                    if(await executeTrade(sym, 'SELL', addQty)) {
                        addLock = true;
                        document.getElementById('statAdd').innerText = parseInt(document.getElementById('statAdd').innerText) + 1;
                    }
                }
            } catch (e) { console.error(e); }
        }

        document.getElementById('runBtn').onclick = () => {
            const k = document.getElementById('apiKey').value;
            const s = document.getElementById('apiSecret').value;
            if(!k || !s) { showTab('settings'); return alert("è¯·å…ˆå¡«å†™ API Keys"); }
            localStorage.setItem('_local_k', k); localStorage.setItem('_local_s', s);
            isRunning = true;
            document.getElementById('runBtn').classList.add('hidden');
            document.getElementById('stopBtn').classList.remove('hidden');
            document.getElementById('dot').className = 'w-2.5 h-2.5 rounded-full bg-emerald-500 animate-pulse';
            document.getElementById('statusTxt').innerText = 'Running';
            document.getElementById('statusTxt').className = 'text-[10px] font-black uppercase tracking-widest text-emerald-400';
            addLog("å“¨å…µå¼•æ“å·²å¯åŠ¨", "text-blue-400 font-black");
            engine(); timer = setInterval(engine, 10000);
        };

        document.getElementById('stopBtn').onclick = () => {
            isRunning = false; clearInterval(timer);
            document.getElementById('runBtn').classList.remove('hidden');
            document.getElementById('stopBtn').classList.add('hidden');
            document.getElementById('dot').className = 'w-2.5 h-2.5 rounded-full bg-slate-500';
            document.getElementById('statusTxt').innerText = 'Offline';
            document.getElementById('statusTxt').className = 'text-[10px] font-black uppercase tracking-widest text-slate-400';
            addLog("ç³»ç»Ÿå·²æ‰‹åŠ¨åœæœº");
        };
    </script>
</body>
</html>
