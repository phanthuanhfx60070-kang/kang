<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFT // CYBER TERMINAL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js" type="application/javascript"></script>
    <style>
        /* --- 赛博朋克核心变量 --- */
        :root {
            --neon-pink: #ff2a6d;
            --neon-blue: #05d9e8;
            --neon-green: #39ff14;
            --dark-bg: #010113;
            --panel-bg: rgba(16, 20, 40, 0.85);
        }

        /* 全局样式 */
        body {
            background-color: var(--dark-bg);
            background-image: 
                linear-gradient(rgba(5, 217, 232, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(5, 217, 232, 0.1) 1px, transparent 1px),
                radial-gradient(circle at 50% 50%, rgba(1, 1, 19, 0) 0%, var(--dark-bg) 100%);
            background-size: 30px 30px, 30px 30px, 100% 100%;
            color: #ffffff;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        /* --- 新增：返回按钮样式 --- */
        .back-nav {
            position: absolute;
            top: 20px;
            left: 20px;
            text-decoration: none;
            color: var(--neon-pink);
            border: 1px solid var(--neon-pink);
            padding: 8px 15px;
            font-size: 0.8rem;
            font-weight: bold;
            background: rgba(0,0,0,0.6);
            transition: all 0.3s;
            z-index: 100;
            text-transform: uppercase;
        }
        .back-nav:hover {
            background: var(--neon-pink);
            color: #000;
            box-shadow: 0 0 15px var(--neon-pink);
        }

        .cyber-container {
            background: var(--panel-bg);
            padding: 2.5rem;
            border: 2px solid var(--neon-blue);
            border-radius: 4px;
            box-shadow: 
                0 0 20px rgba(5, 217, 232, 0.4), 
                inset 0 0 20px rgba(5, 217, 232, 0.2);
            text-align: center;
            max-width: 450px;
            width: 90%;
            position: relative;
            backdrop-filter: blur(5px);
        }

        .corner-decoration {
            position: absolute;
            width: 30px;
            height: 30px;
            border: 2px solid var(--neon-pink);
            box-shadow: 0 0 10px var(--neon-pink);
        }
        .top-left { top: -5px; left: -5px; border-right: none; border-bottom: none; }
        .top-right { top: -5px; right: -5px; border-left: none; border-bottom: none; }
        .bottom-left { bottom: -5px; left: -5px; border-right: none; border-top: none; }
        .bottom-right { bottom: -5px; right: -5px; border-left: none; border-top: none; }

        h1 {
            margin-bottom: 0.5rem;
            color: var(--neon-blue);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--neon-blue);
        }
        
        .pot-box {
            background: #000;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 1px solid #333;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.8);
        }
        .pot-box::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(
                transparent 0px, transparent 2px,
                rgba(0, 255, 0, 0.1) 3px, rgba(0, 255, 0, 0.1) 4px
            );
            pointer-events: none;
        }

        .pot-title { 
            font-size: 0.8rem; color: var(--neon-blue); text-transform: uppercase; 
            margin-bottom: 10px;
        }
        .pot-value { 
            font-size: 2.5rem; 
            font-weight: bold; 
            color: var(--neon-green);
            text-shadow: 0 0 15px var(--neon-green);
            font-family: monospace;
        }
        .unit { color: #64748b; font-size: 0.9rem; }

        .cyber-button {
            background: transparent;
            border: 2px solid var(--neon-pink);
            color: var(--neon-pink);
            padding: 15px 30px;
            font-size: 1.1rem;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 10px rgba(255, 42, 109, 0.4);
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }

        .cyber-button:hover {
            background: var(--neon-pink);
            color: #000;
            box-shadow: 0 0 30px var(--neon-pink);
        }
        .cyber-button:active { transform: scale(0.98); }

        .status { margin-top: 1.5rem; font-size: 0.9rem; min-height: 20px; color: var(--neon-blue); }
        .link { margin-top: 2rem; font-size: 0.8rem; color: #94a3b8; border-top: 1px solid #333; padding-top: 1rem; }
        a { color: var(--neon-blue); text-decoration: none; }
    </style>
</head>
<body>

    <a href="../index.html" class="back-nav">[ &lt;&lt; RETURN // BASE ]</a>

    <div class="cyber-container">
        <div class="corner-decoration top-left"></div>
        <div class="corner-decoration top-right"></div>
        <div class="corner-decoration bottom-left"></div>
        <div class="corner-decoration bottom-right"></div>

        <h1>LIFT // PROTOCOL</h1>

        <div class="pot-box">
            <div class="pot-title">[ CURRENT REWARD POOL ]</div>
            <div class="pot-value" id="potDisplay">LOADING...</div>
            <div class="unit">/// PENDING LIFT TOKENS ///</div>
        </div>

        <button id="actionBtn" class="cyber-button" onclick="connectWallet()">INITIALIZE UPLINK</button>
        <div class="status" id="statusMsg">>> WAITING FOR CONNECTION... <<</div>

        <div class="link">
            CONTRACT NET_ID: <a href="https://bscscan.com/address/0x47b93c2a0920BBe10eFc7854b8FD04a02E85d031" target="_blank">0x47b9...d031</a>
        </div>
    </div>

    <script>
        const CONTRACT_ADDRESS = "0x47b93c2a0920BBe10eFc7854b8FD04a02E85d031";
        const ABI = [
            "function claim() public returns (bool)",
            "function checkCurrentPot() public view returns (uint256)"
        ];

        let provider, signer, contract;

        async function connectWallet() {
            // 调试信息：点按钮必须有反应
            console.log("Button Clicked!");

            if (typeof window.ethereum === 'undefined') {
                alert("错误：未检测到钱包！\n请确保你已安装 MetaMask 插件。\n如果你在手机上，请在钱包App的浏览器里打开此页面。");
                return;
            }

            try {
                setStatus(">> ATTEMPTING CONNECTION... CHECK WALLET <<", "var(--neon-blue)");
                
                // 初始化 Provider
                provider = new ethers.providers.Web3Provider(window.ethereum);
                
                // 请求账号权限
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                const address = await signer.getAddress();
                
                // 检查网络 (BSC)
                const network = await provider.getNetwork();
                if (network.chainId !== 56) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x38' }],
                        });
                        // 切换后刷新 Provider
                        provider = new ethers.providers.Web3Provider(window.ethereum);
                        signer = provider.getSigner();
                    } catch (e) {
                        alert("请切换到 BNB Smart Chain 网络！");
                        setStatus(">> NETWORK ERROR <<", "var(--neon-pink)");
                        return;
                    }
                }

                contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

                // 更新按钮状态
                document.getElementById("actionBtn").innerText = ">>> EXECUTE CLAIM <<<";
                document.getElementById("actionBtn").onclick = claimTokens;
                document.getElementById("actionBtn").style.borderColor = "var(--neon-green)";
                document.getElementById("actionBtn").style.color = "var(--neon-green)";
                
                setStatus(">> UPLINK ESTABLISHED: " + address.substring(0,6) + "... <<", "var(--neon-green)");

                setInterval(updatePot, 2000); 
                updatePot();

            } catch (error) {
                console.error(error);
                alert("连接失败：" + error.message);
                setStatus(">> CONNECTION FAILED <<", "var(--neon-pink)");
            }
        }

        async function claimTokens() {
            if (!contract) return;
            try {
                setStatus(">> INITIATING TRANSACTION... <<", "var(--neon-blue)");
                const tx = await contract.claim();
                setStatus(">> TX SENT. AWAITING CONFIRMATION... <<", "var(--neon-blue)");
                await tx.wait(); 
                setStatus(">> SUCCESS: TOKENS SECURED <<", "var(--neon-green)");
                updatePot();
            } catch (error) {
                console.error(error);
                if (error.code === 4001) {
                    setStatus(">> USER CANCELLED <<", "#64748b");
                } else {
                    alert("抢币失败！可能是被别人抢先了，或者是Gas费不足。");
                    setStatus(">> EXECUTION FAILED <<", "var(--neon-pink)");
                }
            }
        }

        async function updatePot() {
            if (!contract) return;
            try {
                const potRaw = await contract.checkCurrentPot();
                const potFormatted = ethers.utils.formatUnits(potRaw, 18);
                let displayStr = parseFloat(potFormatted).toFixed(4);
                if (displayStr.length < 8) {
                     while(displayStr.length < 8) { displayStr = "0" + displayStr; }
                }
                document.getElementById("potDisplay").innerText = displayStr;
            } catch (error) {
                console.log("读取奖池失败", error);
            }
        }

        function setStatus(msg, color) {
            const el = document.getElementById("statusMsg");
            el.innerText = msg;
            if(color) el.style.color = color;
        }
    </script>
</body>
</html>
