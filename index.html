<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Protocol Gateway</title>
    
    <!-- ‚úÖ Â§™ÊûÅÂõæÊ†á -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='https://raw.githubusercontent.com/phanthuanhfx60070-kang/kang/refs/heads/main/logo.png' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='32' fill='white'/%3E%3Cpath d='M32,0 A32,32 0 0,0 32,64 A16,16 0 0,0 32,32 A16,16 0 0,1 32,0 Z' fill='%2306b6d4'/%3E%3Cpath d='M32,0 A16,16 0 0,1 32,32 A16,16 0 0,0 32,64 A32,32 0 0,0 32,0 Z' fill='%23FFD700'/%3E%3C/svg%3E" type="image/svg+xml">

    <!-- ‚úÖ ÊûÅÈÄüÊ∫ê -->
    <script src="https://cdn.staticfile.org/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=VT323&display=swap" rel="stylesheet">
    
    <style>
        :root { --theme-color: #FFD700; --theme-shadow: rgba(255, 215, 0, 0.5); }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            /* ËÉåÊôØÂõæ */
            background-image: radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                              radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                              radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            background-attachment: fixed; background-size: cover; color: #fff;
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            padding: 2rem 1rem; gap: 1.5rem;
        }

        /* üü¢ Ë°åÊÉÖËÉ∂ÂõäÊ†∑Âºè */
        .ticker-pill {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 999px;
            padding: 6px 16px;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-top: 15px; /* Ë∑ùÁ¶ªÊ†áÈ¢òÁöÑË∑ùÁ¶ª */
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
            position: relative; z-index: 60;
        }
        .ticker-pill:hover { background: rgba(0, 0, 0, 0.6); transform: translateY(-2px); border-color: rgba(255, 255, 255, 0.3); }
        .deploy-link { text-decoration: none; color: #facc15; font-weight: bold; font-size: 12px; display: flex; align-items: center; gap: 6px; }
        .deploy-link:hover { color: #fff; text-shadow: 0 0 8px #facc15; }

        /* ÂèåÂ∏ÅÂç°Áâá */
        .gateway-container { display: flex; flex-direction: column; gap: 20px; width: 100%; max-width: 450px; z-index: 50; margin-top: 20px; }
        .gateway-card {
            background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 2rem;
            text-align: center; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden;
        }
        .gateway-card:hover { transform: translateY(-5px) scale(1.02); }
        
        .card-lift:hover { box-shadow: 0 0 30px rgba(6, 182, 212, 0.4); border-color: #06b6d4; }
        .text-lift { color: #06b6d4; text-shadow: 0 0 10px rgba(6, 182, 212, 0.5); }
        
        .card-kang:hover { box-shadow: 0 0 30px rgba(250, 204, 21, 0.4); border-color: #facc15; }
        .text-kang { color: #facc15; text-shadow: 0 0 10px rgba(250, 204, 21, 0.5); }

        /* ÊåñÁüøÁïåÈù¢ÈÄöÁî® */
        .glass-card {
            background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            width: 100%; max-width: 400px; border-radius: 24px; padding: 2rem; position: relative; z-index: 10;
        }
        .btn-theme {
            background: var(--theme-color); color: #000; transition: all 0.2s; font-weight: 800; border: none; cursor: pointer;
            box-shadow: 0 4px 15px var(--theme-shadow);
        }
        .btn-theme:disabled { background: #475569; color: #94a3b8; cursor: not-allowed; box-shadow: none; opacity: 0.6; }
        
        /* Á∫¢Ëâ≤Ê∏ÖÂú∫ÊåâÈíÆ */
        .btn-clear {
            background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%); color: #fff; transition: all 0.2s; font-weight: 800; border: none; cursor: pointer;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.5); animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }

        .pot-glow { text-shadow: 0 0 25px var(--theme-shadow); color: var(--theme-color); }
        .game-card { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; width: 100%; max-width: 400px; padding: 1rem; text-align: center; overflow: hidden; }
        canvas { background: rgba(255, 255, 255, 0.1); border-radius: 8px; width: 100%; touch-action: none; }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <!-- üü¢ È°∂ÈÉ®Ê†áÈ¢òÂå∫ + Ë°åÊÉÖÈÉ®ÁΩ≤Êù° -->
    <div class="text-center z-20" id="headerSection">
        <h1 class="text-3xl font-extrabold tracking-tight text-white">PROTOCOL <span class="text-yellow-500">GATEWAY</span></h1>
        
        <!-- üëá ËøôÈáåÊòØ‰Ω†Ë¶ÅÊ±ÇÁöÑÔºö24Â∞èÊó∂Ê∂®ÂπÖ + ‰∏ÄÈîÆÈÉ®ÁΩ≤ üëá -->
        <div class="ticker-pill">
            <!-- Ê∂®ÂπÖÈÉ®ÂàÜ -->
            <div class="flex items-center gap-2 border-r border-gray-500/50 pr-4 mr-1">
                <span class="relative flex h-2 w-2">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                </span>
                <div class="flex flex-col items-start leading-none">
                    <span class="text-[9px] text-gray-400 uppercase">24h Change</span>
                    <span class="text-[12px] font-bold text-green-400 font-mono">+128.5%</span>
                </div>
            </div>

            <!-- ÈÉ®ÁΩ≤ÈÉ®ÂàÜ (ÁÇπÂáªË∑≥ËΩ¨ Vercel ÈÉ®ÁΩ≤) -->
            <a href="https://vercel.com/new" target="_blank" class="deploy-link">
                <i class="fas fa-rocket text-sm"></i>
                <span>DEPLOY NOW</span>
            </a>
        </div>
    </div>

    <!-- üü¢ 1. ÂÖ•Âè£ÈÄâÊã©È°µ -->
    <div id="gatewayView" class="gateway-container fade-in">
        <div class="text-center mb-2">
            <p class="text-xs text-gray-500 tracking-widest">CHOOSE YOUR PATH</p>
        </div>

        <!-- LIFT ÂÖ•Âè£ -->
        <div class="gateway-card card-lift" onclick="selectProtocol('LIFT')">
            <div class="text-4xl mb-2 text-lift"><i class="fas fa-cube"></i></div>
            <h2 class="text-2xl font-black text-lift">LIFT</h2>
            <p class="text-xs text-gray-400 mt-2">Cyber ‚Ä¢ Blue ‚Ä¢ Tech</p>
        </div>

        <!-- KANG ÂÖ•Âè£ -->
        <div class="gateway-card card-kang" onclick="selectProtocol('KANG')">
            <div class="text-4xl mb-2 text-kang"><i class="fas fa-bolt"></i></div>
            <h2 class="text-2xl font-black text-kang">KANG</h2>
            <p class="text-xs text-gray-400 mt-2">Gold ‚Ä¢ Power ‚Ä¢ Meme</p>
        </div>
    </div>

    <!-- üü¢ 2. ÊåñÁüø‰∏ªÁïåÈù¢ (ÈöêËóèÔºåÁÇπÂáªÂêéÊòæÁ§∫) -->
    <div id="appView" class="w-full flex flex-col items-center gap-6 hidden fade-in">
        
        <!-- È°∂ÈÉ®ÂØºËà™ -->
        <div class="w-full max-w-[400px] flex justify-between items-center px-2">
            <button onclick="goBack()" class="text-gray-400 hover:text-white text-sm"><i class="fas fa-arrow-left"></i> Back</button>
            <div class="text-center">
                <h1 class="text-2xl font-extrabold tracking-tight" id="protocolTitle" style="color:var(--theme-color)">PROTOCOL</h1>
            </div>
            <div class="w-10"></div>
        </div>

        <div class="glass-card">
            <div class="text-center mb-6">
                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">Current Reward Pot</div>
                <div class="relative">
                    <div id="potValue" class="text-3xl md:text-5xl font-black pot-glow font-mono break-all leading-tight">LOADING...</div>
                    <div class="text-xs font-bold mt-2" style="color:var(--theme-color)">PENDING TOKENS</div>
                    <div id="nodeStatus" class="text-[9px] text-gray-500 mt-1">Connecting...</div>
                </div>
            </div>

            <div id="connectView" class="text-center">
                <button onclick="connectWallet()" class="btn-theme w-full py-4 rounded-xl text-lg shadow-lg flex items-center justify-center gap-2">
                    <i class="fas fa-wallet"></i> ËøûÊé•Èí±ÂåÖ (Connect)
                </button>
            </div>

            <div id="miningView" class="hidden space-y-4">
                <div id="statusLog" class="bg-gray-800/50 rounded-lg p-3 text-xs text-center text-gray-300 font-mono border border-gray-700/50">
                    ÂáÜÂ§áÂ∞±Áª™ System Ready
                </div>

                <div id="infoBar" class="bg-blue-900/30 border border-blue-700/50 rounded-lg p-3 text-left hidden">
                    <div class="text-[11px] text-blue-200 flex items-center gap-2">
                        <i class="fas fa-info-circle"></i> <span id="infoText">Ê£ÄÊµã‰∏≠...</span>
                    </div>
                </div>

                <div class="grid gap-3">
                    <!-- Êä¢Â§∫ (È¢úËâ≤Âä®ÊÄÅ) -->
                    <button id="submitBtn" onclick="submitClaim()" class="btn-theme w-full py-4 rounded-xl text-lg shadow-lg relative overflow-hidden">
                        <div class="relative z-10 flex items-center justify-center gap-2">
                            <i class="fas fa-hammer"></i> Á´ãÂç≥Êä¢Â§∫ (Submit)
                        </div>
                    </button>

                    <!-- ÁªìÁÆó / Ê∏ÖÂú∫ -->
                    <button id="finalizeBtn" onclick="finalizePayout()" disabled class="w-full py-4 rounded-xl font-bold text-lg shadow-lg border-2 border-gray-600 text-gray-500">
                        <div class="flex items-center justify-center gap-2">
                            <i class="fas fa-download"></i> ÁªìÁÆóÈ¢ÜÂ∏Å (Finalize)
                        </div>
                    </button>
                </div>

                <div class="text-center pt-2">
                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-black/20 text-[10px] text-gray-400 font-mono">
                        <div class="w-1.5 h-1.5 rounded-full bg-green-500"></div>
                        <span id="userDisplay">0x00...0000</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-2 mt-6 pt-4 border-t border-gray-700">
                <div class="text-center cursor-pointer p-2 bg-black/20 rounded hover:bg-black/40 text-[10px] text-gray-400" onclick="copyCA()">
                    <i class="fas fa-copy mb-1"></i><br>Â§çÂà∂ÂêàÁ∫¶
                </div>
                <div class="text-center cursor-pointer p-2 bg-black/20 rounded hover:bg-black/40 text-[10px] text-gray-400" onclick="openBscScan()">
                    <i class="fas fa-external-link-alt mb-1"></i><br>Êü•ÁúãÊµèËßàÂô®
                </div>
            </div>
        </div>

        <!-- Ê∏∏Êàè -->
        <div class="game-card fade-in">
            <div class="flex justify-between items-center mb-2 px-1">
                <div class="text-[10px] text-gray-300 font-mono font-bold">WAIT & PLAY</div>
                <div class="text-[10px] text-yellow-400 font-mono font-bold">SCORE: <span id="gameScore">0</span></div>
            </div>
            <canvas id="dinoCanvas" width="600" height="150"></canvas>
            <div class="text-[10px] text-gray-400 mt-2 font-mono blink" id="gameTip">TAP TO START</div>
        </div>
    </div>

    <script>
        // üü¢ ÈÖçÁΩÆÂå∫ÂüüÔºöËØ∑Âú®Ê≠§Â§ÑÂ°´ÂÖ•‰∏§‰∏™ÂêàÁ∫¶Âú∞ÂùÄ
        const CONFIG = {
            KANG: {
                address: "0x65a762e8B7639596dbFBCcd9A541d44B0CF67762",
                color: "#FFD700", shadow: "rgba(255, 215, 0, 0.5)", icon: "ü¶ñ"
            },
            LIFT: {
                // ‚ö†Ô∏è ËÆ∞ÂæóÊç¢ÊàêÁúüÁöÑ LIFT Âú∞ÂùÄ
                address: "0x65a762e8B7639596dbFBCcd9A541d44B0CF67762", 
                color: "#06b6d4", shadow: "rgba(6, 182, 212, 0.5)", icon: "üí†"
            }
        };

        const ABI = [
            "function submitClaim() public",
            "function finalizePayout() public",
            "function checkCurrentPot() public view returns (uint256)",
            "function currentCycle() public view returns (uint256, uint256, address[], bool)"
        ];
        const RPC_LIST = ["https://bsc-dataseed.binance.org/", "https://bsc-dataseed1.defibit.io/", "https://bsc-dataseed1.ninicoin.io/"];

        let currentProtocol = null;
        let provider, signer, contract, readOnlyContract;
        
        const el = {
            header: document.getElementById('headerSection'),
            gateway: document.getElementById('gatewayView'), app: document.getElementById('appView'), title: document.getElementById('protocolTitle'),
            pot: document.getElementById('potValue'), nodeStatus: document.getElementById('nodeStatus'), connectView: document.getElementById('connectView'),
            miningView: document.getElementById('miningView'), status: document.getElementById('statusLog'), user: document.getElementById('userDisplay'),
            submit: document.getElementById('submitBtn'), finalize: document.getElementById('finalizeBtn'), infoBar: document.getElementById('infoBar'), infoText: document.getElementById('infoText')
        };

        // --- Ê†∏ÂøÉÂàáÊç¢ÈÄªËæë ---
        function selectProtocol(name) {
            currentProtocol = name; const cfg = CONFIG[name];
            document.documentElement.style.setProperty('--theme-color', cfg.color);
            document.documentElement.style.setProperty('--theme-shadow', cfg.shadow);
            
            el.title.innerText = name + " PROTOCOL"; el.pot.innerText = "LOADING...";
            
            // ÈöêËóèÂÖ•Âè£ÂíåÈ°∂ÈÉ®Ê†áÈ¢ò
            el.gateway.classList.add('hidden');
            el.header.classList.add('hidden'); // üëà ËøõÂÖ•ÂÜÖÈ°µÂêéÈöêËóèÈ°∂ÈÉ®Â§ßÊ†áÈ¢ò
            
            el.app.classList.remove('hidden');
            initContract(); initGame();
        }

        function goBack() { location.reload(); }

        // --- ÂêàÁ∫¶ÈÄªËæë ---
        async function initContract() {
            if(typeof ethers === 'undefined') { el.pot.innerText = "Lib Error"; return; }
            const ca = CONFIG[currentProtocol].address;
            let connected = false;
            for (let rpc of RPC_LIST) {
                try {
                    const tempProvider = new ethers.providers.JsonRpcProvider(rpc);
                    readOnlyContract = new ethers.Contract(ca, ABI, tempProvider);
                    await readOnlyContract.checkCurrentPot();
                    el.nodeStatus.innerText = "üü¢ Node Synced (" + currentProtocol + ")";
                    connected = true; loopPot(); checkGlobalState(); setInterval(checkGlobalState, 3000); break;
                } catch(e) {}
            }
            if(!connected) { el.pot.innerText = "Net Error"; }
            if(window.ethereum) { const acc = await window.ethereum.request({method:'eth_accounts'}); if(acc.length > 0) connectWallet(); }
        }

        async function loopPot() {
            if(readOnlyContract) { try { const v = await readOnlyContract.checkCurrentPot(); el.pot.innerText = parseFloat(ethers.utils.formatUnits(v, 18)).toFixed(4); } catch(e) {} }
            setTimeout(loopPot, 3000);
        }

        // üî¥ ÊàòÁï•Ê∏ÖÂú∫ÈÄªËæë
        async function checkGlobalState() {
            if(!readOnlyContract) return;
            try {
                const cycleData = await readOnlyContract.currentCycle();
                const startTime = cycleData[1]; const isFinalized = cycleData[3];
                if(startTime.gt(0) && !isFinalized) {
                    el.submit.disabled = true; el.submit.innerHTML = "<i class='fas fa-lock'></i> LOCKED"; el.submit.style.opacity = "0.5";
                    el.finalize.disabled = false; el.finalize.className = "btn-clear w-full py-4 rounded-xl font-bold text-lg shadow-lg"; 
                    el.finalize.innerHTML = "<i class='fas fa-trash'></i> Âº∫Âà∂ÁªìÁÆó (Âè™Ê∏ÖÂú∫)"; el.finalize.style.border = "none"; el.finalize.style.color = "white";
                    el.infoBar.classList.remove('hidden'); el.infoText.innerText = "‚ö†Ô∏è Êã•Â†µ‰∏≠ÔºÅËØ∑ÁÇπÂáªÁ∫¢Ëâ≤ÊåâÈíÆÊ∏ÖÂú∫„ÄÇ";
                } else {
                    el.submit.disabled = false; el.submit.innerHTML = "<i class='fas fa-hammer'></i> Á´ãÂç≥Êä¢Â§∫"; el.submit.style.opacity = "1";
                    el.finalize.disabled = true; el.finalize.className = "w-full py-4 rounded-xl font-bold text-lg border-2 border-gray-600 text-gray-500 cursor-not-allowed";
                    el.finalize.style.background = "transparent"; el.finalize.style.boxShadow = "none"; el.finalize.innerHTML = "Á≠âÂæÖÊä¢Â§∫..."; el.infoBar.classList.add('hidden');
                }
            } catch(e) {}
        }

        async function connectWallet() {
            if(!window.ethereum) return alert("ËØ∑Âú®Èí±ÂåÖ‰∏≠ÊâìÂºÄÔºÅ");
            try {
                await window.ethereum.request({ method: 'eth_requestAccounts' }); await switchToBSC();
                provider = new ethers.providers.Web3Provider(window.ethereum); signer = provider.getSigner();
                const ca = CONFIG[currentProtocol].address; contract = new ethers.Contract(ca, ABI, signer); readOnlyContract = contract;
                const addr = await signer.getAddress(); el.connectView.classList.add('hidden'); el.miningView.classList.remove('hidden');
                el.user.innerText = addr.slice(0,6) + "..." + addr.slice(-4); checkGlobalState();
            } catch(e) { alert("ËøûÊé•Â§±Ë¥•"); }
        }

        async function submitClaim() {
            try { setStatus("ËØ∑Ê±ÇÁ≠æÂêç...", "loading"); const tx = await contract.submitClaim(); setStatus("‰∏äÈìæ‰∏≠...", "loading"); await tx.wait(); setStatus("‚úÖ ÊàêÂäüÔºÅÁ≠âÂæÖÁªìÁÆó", "success"); checkGlobalState(); } catch(e) { handleErr(e); }
        }

        async function finalizePayout() {
            try { setStatus("Ê∏ÖÂú∫‰∏≠...", "loading"); const tx = await contract.finalizePayout(); await tx.wait(); setStatus("üßπ Â∑≤Ê∏ÖÂú∫ÔºåÂà∑Êñ∞‰∏≠...", "success"); setTimeout(() => { location.reload(); }, 2000); } catch(e) { handleErr(e); }
        }

        async function switchToBSC() {
            try { await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }] }); } catch (e) {
                if (e.code === 4902) await window.ethereum.request({ method: 'wallet_addEthereumChain', params: [{ chainId: '0x38', chainName: 'Binance Smart Chain', nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 }, rpcUrls: ['https://bsc-dataseed.binance.org/'], blockExplorerUrls: ['https://bscscan.com/'] }] });
            }
        }

        function setStatus(msg, type) {
            const s = document.getElementById('statusLog'); s.innerText = msg;
            if(type === 'loading') s.className = "bg-blue-900/30 text-blue-300 border border-blue-800 rounded p-3 text-xs text-center";
            else if(type === 'success') s.className = "bg-green-900/30 text-green-300 border border-green-800 rounded p-3 text-xs text-center";
            else s.className = "bg-gray-800/50 text-gray-300 border border-gray-700/50 rounded p-3 text-xs text-center";
        }
        function handleErr(e) { let m = e.reason || "‰∫§ÊòìÂ§±Ë¥•"; if(m.includes("user rejected")) m = "Áî®Êà∑ÂèñÊ∂à"; if(m.includes("Already submitted")) { m = "ËØ∑Ê∏ÖÂú∫"; checkGlobalState(); } setStatus("‚ùå " + m, "error"); }
        function copyCA() { navigator.clipboard.writeText(CONFIG[currentProtocol].address); alert("‚úÖ Â∑≤Â§çÂà∂"); }
        function openBscScan() { window.open(`https://bscscan.com/address/${CONFIG[currentProtocol].address}`, '_blank'); }

        function initGame() {
            const canvas = document.getElementById('dinoCanvas'); const ctx = canvas.getContext('2d'); const scoreEl = document.getElementById('gameScore');
            let gameRunning = false, score = 0; let dino = { x: 50, y: 110, dy: 0, jumpPower: -8, ground: 110 }; let cactus = { x: 600, y: 110, speed: 4 }; let gravity = 0.4;
            function reset() { dino.y = dino.ground; dino.dy = 0; cactus.x = 600; score = 0; scoreEl.innerText = 0; gameRunning = true; document.getElementById('gameTip').innerText = ">>> RUNNING <<<"; requestAnimationFrame(update); }
            function jump() { if(!gameRunning) reset(); else if(dino.y === dino.ground) dino.dy = dino.jumpPower; }
            canvas.addEventListener('mousedown', jump); canvas.addEventListener('touchstart', (e) => { e.preventDefault(); jump(); }); document.addEventListener('keydown', (e) => { if(e.code === 'Space') { e.preventDefault(); jump(); } });
            function update() {
                if(!gameRunning) return; ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.beginPath(); ctx.moveTo(0, 125); ctx.lineTo(600, 125); ctx.strokeStyle = 'rgba(255,255,255,0.3)'; ctx.lineWidth = 2; ctx.stroke();
                if(dino.y < dino.ground) dino.dy += gravity; dino.y += dino.dy; if(dino.y > dino.ground) { dino.y = dino.ground; dino.dy = 0; }
                ctx.font = "30px serif"; ctx.textAlign = "left"; ctx.textBaseline = "bottom"; ctx.fillText(CONFIG[currentProtocol] ? CONFIG[currentProtocol].icon : "ü¶ñ", dino.x, dino.y + 15); 
                cactus.x -= cactus.speed; if(cactus.x < -30) { cactus.x = 600 + Math.random() * 200; score++; scoreEl.innerText = score; cactus.speed += 0.1; } ctx.fillText("üåµ", cactus.x, 125);
                if(dino.x < cactus.x + 20 && dino.x + 20 > cactus.x && dino.y > dino.ground - 20) { gameRunning = false; ctx.fillStyle = 'white'; ctx.font = 'bold 24px monospace'; ctx.textAlign = 'center'; ctx.fillText("GAME OVER", 300, 60); document.getElementById('gameTip').innerText = "TAP TO RESTART"; } else requestAnimationFrame(update);
            }
            ctx.fillStyle = 'rgba(255,255,255,0.8)'; ctx.font = 'bold 20px monospace'; ctx.textAlign = 'center'; ctx.fillText("TAP TO START", 300, 70);
        }
    </script>
</body>
</html>
